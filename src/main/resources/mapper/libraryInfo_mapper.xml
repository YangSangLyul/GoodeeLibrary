<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.spring.main.dao.LibraryInfoDAO">
	<select id="list" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT  NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS ,rnum
		FROM(
				SELECT NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS,
				ROW_NUMBER() OVER(ORDER BY NOTICEIDX DESC) AS rnum FROM notice		
			)
		WHERE rnum BETWEEN #{param1} AND #{param2}
	</select>
	
	<select id="allCount" resultType="int">
		SELECT COUNT(NOTICEIDX) FROM notice
	</select>
	
	
<select id="noticeDetail" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS FROM notice WHERE NOTICEIDX = #{param1}
	</select>
	
	
<select id="searchList" parameterType="hashmap"  resultType="com.spring.main.dto.LibraryInfoDTO">
	SELECT  NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS ,rnum
		FROM(
				SELECT NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS,
				ROW_NUMBER() OVER(ORDER BY NOTICEIDX DESC) AS rnum FROM (
				
				SELECT NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS FROM notice
		<where>
			<if test="searchSelect.equals('전체')">
			 content LIKE '%'||#{search}||'%' OR subject LIKE '%'||#{search}||'%'))
			</if>
			<if test="searchSelect.equals('제목')">
			subject LIKE '%'||#{search}||'%'))
			</if>
			<if test="searchSelect.equals('내용')">
			content LIKE '%'||#{search}||'%'))
			</if>
		</where>	
		WHERE rnum BETWEEN #{start} AND #{end}
	</select>
	
 	<select id="searchCount" parameterType="hashmap" resultType="int">
 	
		SELECT COUNT(NOTICEIDX) FROM (SELECT NOTICEIDX ,ID ,SUBJECT ,CONTENT ,REG_DATE ,NOTICESTATUS FROM notice
		<where>
			<if test="searchSelect.equals('전체')">
			 content LIKE '%'||#{search}||'%' OR subject LIKE '%'||#{search}||'%')
			</if>
			<if test="searchSelect.equals('제목')">
			subject LIKE '%'||#{search}||'%')
			</if>
			<if test="searchSelect.equals('내용')">
			content LIKE '%'||#{search}||'%')
			</if>
		</where>
	</select>
	
	<select id="faq_infoNotice" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT * FROM FAQ ORDER BY FAQIDX ASC
	</select>
	
	
	<select id="faqSearch_infoNotice" parameterType="hashmap" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT * FROM faq
		<where>
			<if test="searchSelect.equals('전체')">
			 content LIKE '%'||#{search}||'%' OR anwser LIKE '%'||#{search}||'%'
			</if>
			<if test="searchSelect.equals('제목')">
			anwser LIKE '%'||#{search}||'%'
			</if>
		<!-- 	<if test="searchSelect.equals('답변')">
			content LIKE '%'||#{search}||'%'
			</if> -->
		</where>
		ORDER BY FAQIDX ASC
	</select>
	
	
	<select id="questionAll_List"  parameterType="int" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT  QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS, TYPE ,rnum
		FROM(
				SELECT QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS,TYPE,
				ROW_NUMBER() OVER(ORDER BY QUEIDX DESC) AS rnum FROM (
				SELECT QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS,TYPE FROM QUESTION		
		)	
			) WHERE rnum BETWEEN #{param1} AND #{param2}
		
	</select>
	<select id="questionAll_Count" resultType="int">
	SELECT COUNT(QUEIDX) FROM (SELECT * FROM QUESTION)
	</select>
	
	<select id="questionList"  parameterType="int" resultType="com.spring.main.dto.LibraryInfoDTO">
		SELECT  QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS, TYPE ,rnum
		FROM(
				SELECT QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS,TYPE,
				ROW_NUMBER() OVER(ORDER BY QUEIDX DESC) AS rnum FROM (
				SELECT QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS,TYPE FROM QUESTION
				<where>
				<if test="param3==1">
				TYPE ='Q001'
				</if>
				<if test="param3==2">
				TYPE ='Q002'
				</if>
				<if test="param3==3">
				TYPE ='Q003'
				</if>
				<if test="param3==4">
				TYPE ='Q004'
				</if>
				</where>	
		)	
			) WHERE rnum BETWEEN #{param1} AND #{param2}
	</select>
	
	<select id="question_roomCount"  resultType="int">
	SELECT COUNT(QUEIDX) FROM (SELECT * FROM QUESTION WHERE TYPE = 'Q001')
	</select>
	<select id="question_bookCount"  resultType="int">
	SELECT COUNT(QUEIDX) FROM (SELECT * FROM QUESTION WHERE TYPE = 'Q002')
	</select>
	<select id="question_serviceCount"  resultType="int">
	SELECT COUNT(QUEIDX) FROM (SELECT * FROM QUESTION WHERE TYPE = 'Q003')
	</select>
	<select id="question_guitarCount"  resultType="int">
	SELECT COUNT(QUEIDX) FROM (SELECT * FROM QUESTION WHERE TYPE = 'Q004')
	</select>
	<insert id="questionWriting" parameterType="hashmap">
	<!-- loginId=, type=Q003, subject=가입인사드립니다/., content=sdfsafsdaf, false=FALSE -->
	INSERT INTO QUESTION (QUEIDX,ID,SUBJECT,CONTENT,REG_DATE,SHOWSTATUS,ANSSTATUS,TYPE) VALUES 
	<choose>
		<when test="false.equals('FALSE')">
		(QUEIDX_seq.NEXTVAL,#{loginId},#{subject},#{content},SYSDATE,#{false},'FALSE',#{type})
		</when>
		<otherwise>
		(QUEIDX_seq.NEXTVAL,#{loginId},#{subject},#{content},SYSDATE,#{false},'FALSE',#{type})
		</otherwise>
	</choose>
	</insert>
	<select id="questionDetail" resultType="hashmap">
	SELECT * FROM QUESTION WHERE QUEIDX = #{idx}
	</select>
	
</mapper>