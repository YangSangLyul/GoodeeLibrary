<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.spring.main.dao.AdminDAO">

	<!-- 리뷰 추천 수 많은 유저 -->
	<select id="manyUp" resultType="com.spring.main.dto.AdminDTO" parameterType="list">
		<![CDATA[
			SELECT * FROM (
			    SELECT ROW_NUMBER() OVER(ORDER BY COUNT(r.id) DESC) AS rnum, r.id, COUNT(r.id) "cnt" FROM ReviewRecommend c JOIN review r 
			    ON c.reviewIdx = r.reviewIdx AND TO_CHAR(c.recom_date,'YYYYMM') = TO_CHAR(add_months(sysdate,-1), 'YYYYMM') GROUP BY r.id
			) WHERE rnum <= 3
		]]>
	</select>
	
	<!-- 리뷰 많이 작성한 유저 -->
	<select id="manyReview" resultType="com.spring.main.dto.AdminDTO" parameterType="list">
		<![CDATA[
			SELECT * FROM (
			    SELECT ROW_NUMBER() OVER(ORDER BY COUNT(id) DESC) AS rnum,
			        id, COUNT(id) AS "cnt" FROM review WHERE TO_CHAR(reg_date,'YYYYMM') = TO_CHAR(add_months(sysdate,-1), 'YYYYMM')
			        GROUP BY id
			) WHERE rnum <= 3
		]]>
	</select>
	
	<insert id="selectKing" parameterType="list">
		INSERT INTO bestreview(id, month_rcnt) VALUES(#{param1}, #{param2})
	</insert>
	
	<select id="hideBtn" resultType="com.spring.main.dto.AdminDTO" parameterType="list">
		SELECT reg_date FROM bestreview WHERE TO_CHAR(reg_date,'YYYYMM') = TO_CHAR(SYSDATE, 'YYYYMM')
	</select>
	
</mapper>