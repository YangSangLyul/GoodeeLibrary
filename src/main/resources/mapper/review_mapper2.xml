<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
   "-//mybatis.org//DTD Mapper 3.0//EN"
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd"
>

<mapper namespace="com.spring.main.dao.ReviewDao2">
	<select id="reviewList" resultType="review" parameterType="list">
		SELECT r.id, r.cnt, r.reg_date, r.reviewIdx,b.bookImg, b.bookName, b.writer, b.publisher FROM
			book b JOIN review r ON b.bookIdx=r.bookIdx ORDER BY reg_date DESC
	</select>
	
	<select id="reviewCom" resultType="review" parameterType="list">
		SELECT r.id, r.cnt, r.reg_date, r.reviewIdx,b.bookImg, b.bookName, b.writer, b.publisher FROM
			book b JOIN review r ON b.bookIdx=r.bookIdx ORDER BY cnt DESC
	</select>
	
	<select id="reviewIdList" resultType="review" parameterType="list">
			SELECT r.id, r.cnt, r.reviewIdx, b.bookImg, b.bookName, b.writer, b.publisher FROM
			book b JOIN review r ON b.bookIdx=r.bookIdx WHERE id=#{param1}
	</select>
	
		<select id="reviewDetail" resultType="review">
			SELECT r.id, r.cnt, r.reviewIdx, r.content, r.reg_date, b.bookImg, b.bookName, b.writer, b.publisher FROM
			book b JOIN review r ON b.bookIdx=r.bookIdx WHERE reviewIdx=#{param1}
	</select>

	<select id="reviewReportForm" resultType="review">
			SELECT reviewIdx, id FROM review WHERE reviewIdx=#{param1}
	</select>
	

 	<insert id="reviewReport" parameterType="review">
			INSERT INTO reviewreport(reportIdx, reviewIdx, reportId, reportReason,id) 
			VALUES (reportIdx_seq.NEXTVAL, #{reviewIdx}, #{reportId}, #{reportReason},'loginId')
	</insert> 

 	<update id="reportCntUp">
			UPDATE member SET reviewreportcnt = reviewreportcnt+1 
			WHERE id = (SELECT reportid FROM reviewreport WHERE reviewIdx=#{reviewIdx})
	</update> 
		
</mapper>